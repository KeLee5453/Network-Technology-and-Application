# 网络技术与应用-路由器的配置 实验报告

## 实验目的

1. 路由的配置和维护是网络管理员的一项重要任务． 路由的正确配置是保证互联网畅通的首要条件。 
2. 通过实验熟悉并深入理解路由表的建立、配置与使用。
3. 理解RIP协议的运作方式。
4. 学会将计算机配置为路由器。
5. 学会使用Packet Tracer仿真环境下配置路由器。

## 实验内容

1. 使用VMware 中的4台Windows Server 2003 虚拟机搭建3个物理网络，使用两个虚拟机作为路由器。两个作为PC，让两个PC之间能够互相ping通。
2. 在 Cisco Packet Tracer 仿真环境下，搭建与真实环境下相同的网络结构，并使用配置界面对路由器PC等进行配置。

## 实验要求

1.  两个实验中路由器网络中的任何一台主机均可通过ping命令或tracert命令连通至另一台主机，并且输出正确。 
2.  在截止日期前提交实验报告，实验报告需要包括各步骤的截图和说明。 

## 实验原理

### 表驱动IP选路的基本思想

1. 在需要路由选择的设备中保存一张IP路由表
2. IP路由表存储着有关可能的目的地址及怎样到达目的地址的信息
3. 在转发IP数据报时，查询IP路由表，决定把数据报发往何处

### 无类别域间路由

1. 路由表：（M，N，R）三元组。
2. M：掩码；N：目的地址；R：到N路径上“下一个”路由器的IP地址。
3. 路由方法：取出IP数据报中的目的IP地址，与路由表的“掩码”逐位相“与”，结果再与表目中“目的地址”比较。如果相同，说明选路成功，数据报沿“下一站地址”转发出去。

### 静态路由

1. 静态路由是由人工建立和管理的。
2. 静态路由不会自动发生变化。
3. 静态路由必须手工更新以反映互联网拓扑结构或连接方式变化。
4. 不适用于复杂的互联网结构：建立和维护工作量大，容易出现路由环
5. 互联网出现故障，静态路由不会自动做出更改

### 向量-距离路由选择算法  

1. 路由器周期性地向其相邻路由器广播自己知道的路由信息，用于通知相邻路由器自己可以到达的网络以及到达该网络的距离。
2. 相邻路由器可以根据收到的路由信息修改和刷新自己的路由表。

## 第一部分

### 实验环境

Windows Server 2003、双网卡。

### 网络拓扑结构图

![InkedPicture1_LI](C:\Users\a1547\Desktop\InkedPicture1_LI.jpg)

### 实验步骤

#### 配置互联网中主机的IP地址和默认路由

按照拓扑图中的IP地址配置好主机的IP地址与默认路由，

PCA：IP：193.22.0.1、子网掩码：255.255.0.0、默认路由：193.22.0.2；

PCB：IP：193.24.0.2、子网掩码：255.255.0.0、默认路由：193.24.0.1；

#### 配置路由设备的 IP 地址

因为我们使用的是双网卡，所以需要配置两个网卡的IP地址与子网掩码

R1：本地连接：IP：193.22.0.2、子网掩码：255.255.0.0；

​		本地连接2：IP：193.23.0.2、子网掩码：255.255.0.0；

R2：本地连接：IP：193.24.0.1、子网掩码：255.255.0.0；

​		本地连接2：IP：193.23.0.1、子网掩码：255.255.0.0；

#### 利用图形界面配置路由设备的静态路由

route命令可以显示和配置机器的路由，但是在配置前需要修改Windows Server 2003 的注册表。在添加静态路由的时候注意两个网卡，那么网关就应该是连接目的网络的网卡，即使是同一台电脑，也是从这个网卡跳到另一个网卡。

1. 打开WIN+R 运行regedit，然后进入：`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ Tcpip\Parameters`找到`PEnableRouter` 修改其值为0x1；

2. 打开服务器管理工具，找到“路由和远程访问”程序，按照指示启动程序。点开IP路由选择-静态路由。点击操作，然后添加静态路由。

3. 添加本地连接的静态路由，目标：193.24.0.0、网络掩码：255.255.0.0、网关：193.23.0.2等；R1配置好的静态路由表如下：

   ![IMG_20191119_180020](C:\Users\a1547\Desktop\大三上\网络技术与应用\实验\实验4-路由（仿真）\IMG_20191119_180020.jpg)

   R2的如下：

   ![IMG_20191119_180050](C:\Users\a1547\Desktop\大三上\网络技术与应用\实验\实验4-路由（仿真）\IMG_20191119_180050.jpg)

#### 配置RIP

点击IP路由选择，然后点击操作，点击“新增路由协议”就可以对每个接口上运行的RIP进行配置，也就是配置好本地连接和本地连接2；RIP协议运行起来隔一会儿就可以看到路由表的变化情况了。

#### 测试配置的路由

使用PCA命令行运行`tracert 193.24.0.2`

结果如下，就可以看到途中经过的路由器的IP与目的IP了。

![IMG_20191119_175136](C:\Users\a1547\Desktop\大三上\网络技术与应用\实验\实验4-路由（仿真）\IMG_20191119_175136.jpg)

## 第二部分

### 实验环境

 Cisco Packet Tracer。

### 网络拓扑结构图

![image-20191121201836954](C:\Users\a1547\AppData\Roaming\Typora\typora-user-images\image-20191121201836954.png)

### 实验步骤

#### 配置互联网中的主机地址和默认路由

按照第一部分的思路对PC0进行配置，配置如下：PC1，2，3，同理。

![image-20191121194233364](C:\Users\a1547\AppData\Roaming\Typora\typora-user-images\image-20191121194233364.png)

#### 配置路由器接口的IP地址

在配置路由器接口的IP地址时，单击需要配置的路由器，如：R0，然后选择CLI，

按次序输入以下的命令

```powershell
enable 
config terminal 
interface Gig0/0/0
ip address 10.1.0.2 255.255.0.0
no shutdown
exit
interface Gig0/0/1
ip address 10.2.0.2 255.255.0.0
no shutdown
exit
```

就配置好了接口的IP地址。R1的配置同上。

#### 静态路由的配置

在全局模式下对静态路由进行配置，输入以下命令就可以进行配置

```powershell
ip route 10.3.0.0 255.255.0.0 10.2.0.1
exit
```

然后使用

```powershell
show ip route
```

命令显示配置的静态路由表，配置好的静态路由表如下：

![路由器的路由表](C:\Users\a1547\Desktop\大三上\网络技术与应用\实验\实验4-路由（仿真）\路由器的路由表.jpg)



#### 网络连通性测试

使用PC0 ping PC3 的结果如下，同样可以看出经过的路由器的IP与目的地址。

![PC0 ping PC3](C:\Users\a1547\Desktop\大三上\网络技术与应用\实验\实验4-路由（仿真）\PC0 ping PC3.jpg)

使用模拟环境观察数据包的传送过程：

1. PC0发送ARP数据报到交换机
2. 交换机把数据转发到路由器R0和PC1
3. 然后R0把ARP数据包经交换机传送到PC0
4. 然后PC0传送ICMP到交换机0到路由器R0，到R1，再到交换机1，交换机再转发到PC3。
5. PC3再发送相应的ICMP到PC0；

![image-20191121202757192](C:\Users\a1547\AppData\Roaming\Typora\typora-user-images\image-20191121202757192.png)

在网络闲置的时候，路由器之前还会发送RIP数据包

![image-20191121202841659](C:\Users\a1547\AppData\Roaming\Typora\typora-user-images\image-20191121202841659.png)

